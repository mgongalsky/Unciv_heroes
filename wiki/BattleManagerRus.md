# BattleManager

## Описание

`BattleManager` — это класс, отвечающий за управление логикой сражений между двумя армиями. Он не содержит визуальных элементов и фокусируется исключительно на обработке игрового процесса. BattleManager управляет порядком ходов, проверкой доступности действий, применением атак и передвижением войск.

### Основная роль в архитектуре

- Отвечает за управление битвами между двумя армиями (`attackerArmy` и `defenderArmy`).
- Поддерживает очередь ходов (`turnQueue`) для определения порядка действий юнитов.
- Обеспечивает проверку и выполнение действий, таких как атака, перемещение и стрельба.
- Содержит основные алгоритмы взаимодействия юнитов: атака, получение урона, передвижение.

## Основные функции

### `initializeTurnQueue()`
- Инициализирует очередь ходов на основе скорости юнитов.
- Атакующие получают приоритет в случае одинаковой скорости.

### `getCurrentTroop()`
- Возвращает текущий юнит, который должен совершить ход.

### `performTurn(actionRequest: BattleActionRequest): BattleActionResult`
- Выполняет действие (атака, перемещение или стрельба) для указанного юнита.
- Проверяет корректность целевого положения, доступность действия и обрабатывает его выполнение.
- Возвращает результат действия в виде `BattleActionResult`.

### `isBattleOn(): Boolean`
- Проверяет, продолжается ли битва.
- Возвращает `true`, если у обеих армий остались живые юниты.

### `attack(defender: TroopInfo, attacker: TroopInfo? = getCurrentTroop()): Boolean`
- Выполняет атаку одного юнита на другого.
- Расчитывает урон, уничтожение юнитов и возвращает, сработала ли удача.

### `removeTroop(troop: TroopInfo)`
- Удаляет юнит из сражения.
- Убирает его из очереди ходов и армии.

### `advanceTurn()`
- Переключает ход на следующий юнит в очереди.
- Если очередь пуста, завершает битву.

### `getReachableTiles(troop: TroopInfo): List<Vector2>`
- Возвращает список всех доступных клеток для перемещения указанного юнита на основе его скорости.

### `isHexAchievable(troop: TroopInfo, targetPosition: Vector2): Boolean`
- Проверяет, может ли юнит достичь указанной клетки.

### `canShoot(troop: TroopInfo): Boolean`
- Проверяет, может ли указанный юнит стрелять.

## Философия и функционал

Класс `BattleManager` — это центральный элемент системы битв. Он обеспечивает универсальную обработку действий, таких как атаки, перемещения и проверка состояния сражения. Функции класса минимизируют сложность взаимодействия армий и юнитов, абстрагируя логику игры от визуализации. Это позволяет сосредоточиться на реализации уникальных механик боя, таких как удача и мораль, без привязки к конкретному интерфейсу.

---

## Пример использования

```kotlin
val attackerArmy = ArmyInfo(...)
val defenderArmy = ArmyInfo(...)
val battleManager = BattleManager(attackerArmy, defenderArmy)

// Инициализация битвы
battleManager.initializeTurnQueue()

// Производство хода
val actionRequest = BattleActionRequest(currentTroop, ActionType.MOVE, targetPosition)
val result = battleManager.performTurn(actionRequest)

// Проверка идёт ли еще битва
if (!battleManager.isBattleOn()) {
    val result = battleManager.getBattleResult()
    println("Battle Winner: ${result?.winningArmy}")
}
